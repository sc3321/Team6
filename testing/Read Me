Here is my code for the top level module after debugging. I have not tested it yet, and will do that tomorrow 28/11.
